<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>When Git merges go rogue | DC Coding</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Roboto+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Rubik:ital,wght@0,400;0,700;1,400;1,700&family=Trirong:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/code.css">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for DC Coding" href="/Feed/" />

</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
  
  <nav class="bg-gray-800">
    <div class="container flex flex-row justify-center px-6">
      
      <a class="text-gray-100 text-lg px-4 py-2 hover:bg-gray-700 hover:underline" href="/">Home</a>
      
      <a class="text-gray-100 text-lg px-4 py-2 hover:bg-gray-700 hover:underline" href="/Archive">Archive</a>
      
      <a class="text-gray-100 text-lg px-4 py-2 hover:bg-gray-700 hover:underline" href="/About">About</a>
      
      <a class="text-gray-100 text-lg px-4 py-2 hover:bg-gray-700 hover:underline" href="/Subscribe">Subscribe</a>
      
    </div>
  </nav>

  

<div class="bg-blue-800">
  <div class="container py-8">
    <h1 class="text-gray-50 text-6xl font-title font-bold italic">When Git merges go rogue</h1>
    
    <p class="text-gray-200 text-lg mt-2">15 May 2019</p>
    
  </div>
</div>

<div class="container py-6">
  <p class="text-3xl italic text-gray-500 mb-6">How do you resolve a merge conflict in Git?</p>

  <article class="prose">
    <p>Most of the time, merging in Git is pretty simple. The files changed on either
side of the merge are different, or the lines that have been changed are far
enough away from each other that it's obvious to what the result should be.</p>
<p>However, eventually all Git users come up against <strong>merge conflicts</strong>. This is
when Git cannot automatically create the merge commit because the same line in
the same file was changed in different ways since the last common commit between
the two branches.</p>
<p>Here's the simplest Git history where this situation can arise.</p>
<p><img src="/assets/images/2019-05-05-when-git-merges-go-rogue/git-history.png" alt="Git
history"></p>
<p>Commits B1 and B2 change the same line in the same file. If you try to merge
branch 2 into branch 1, you'll get a merge conflict.</p>
<p>Let's have a look at a couple of situations where this could happen, and then
I'll explain the general principle before resolving the conflicts in the two
examples.</p>
<h2>To-do list</h2>
<p>I keep my to-do list in source control (don't ask me why).</p>
<p>It's a simple text file with a list of things I need to do, and the order
doesn't matter (I live a very relaxed life with no deadlines).</p>
<pre><code>// Commit A
Shopping
Clean toilets
Write blog post
Email Dad
</code></pre>
<pre><code>// Commit B1
Shopping
Take bins out
Clean toilets
Write blog post
Email Dad
</code></pre>
<pre><code>// Commit B2
Shopping
Water plants
Clean toilets
Write blog post
Email Dad
</code></pre>
<p>Commit B1 adds &quot;Take bins out&quot; and commit B2 adds &quot;Water plants&quot;, but crucially
they're both added at the same line.</p>
<p>Conflict!</p>
<h2>Windows Forms app</h2>
<p>I have a class in a Windows Forms application which helps me pop up messages to
the user.</p>
<pre class="language-cs"><code class="language-cs"><span class="token comment">// Commit A</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ErrorHelper</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowErrorMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> errorMessage<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">ShowMessage</span><span class="token punctuation">(</span><span class="token string">"Error: "</span> <span class="token operator">+</span> errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cs"><code class="language-cs"><span class="token comment">// Commit B1</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ErrorHelper</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowErrorMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> errorMessage<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">ShowMessage</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Error: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">errorMessage</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cs"><code class="language-cs"><span class="token comment">// Commit B2</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ErrorHelper</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowErrorMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> errorMessage<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">ShowMessageBox</span><span class="token punctuation">(</span><span class="token string">"Error: "</span> <span class="token operator">+</span> errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMessageBox</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Commit B1 refactors to use an interpolated string; commit B2 renames a method.
Both changes are on line 5.</p>
<p>Conflict!</p>
<h2>How to resolve merge conflicts</h2>
<p>When you make a change to a file, you know the <strong>semantics</strong> of the change; that
is, <strong>what the change meant</strong>.</p>
<p>When you commit, Git records the <strong>syntax</strong> of the change; that is, <strong>which
lines were changed and how</strong>.</p>
<p>This helps us to sketch out a plan for fixing merge conflicts. We need to work
out, in the following order:</p>
<ol>
<li>The syntax of the two changes</li>
<li>The semantics of the two changes</li>
<li>The desired semantics of the resultant change</li>
<li>The desired syntax of the resultant change</li>
</ol>
<p>Git works with files that could <strong>mean</strong> anything: source code in any
programming language, software documentation, legal documents, personal notes,
and so on. Because of this, steps 2 and 3 require human intervention. What
happens in step 2 will depend on what sort of document you are looking at; that
is, what the document <strong>means</strong>.</p>
<p>Let's apply this to our two examples.</p>
<h2>To-do list</h2>
<p>Applying the general principle:</p>
<table>
  <thead>
    <tr>
      <th>Step</th>
      <th>Commit B1</th>
      <th>Commit B2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1. Syntax</td>
      <td>Add “Take bins out” at line 2</td>
      <td>Add “Water plants” at line 2</td>
    </tr>
    <tr>
      <td>2. Semantics</td>
      <td>Add “Take bins out” to the list</td>
      <td>Add “Water plants” to the list</td>
    </tr>
    <tr>
      <td>3. Resultant semantics</td>
      <td colspan="2">Add “Take bins out” and “Water plants” to the list</td>
    </tr>
    <tr>
      <td>4. Resultant syntax</td>
      <td colspan="2">Add “Take bins out” at line 2 and “Water plants” at line 3</td>
    </tr>
  </tbody>
</table>
<p>The key here is that the order doesn't matter; the document means an unordered
list of tasks.</p>
<p>Note that the resultant syntax change could have been to add the new tasks at
any point in the file, because the order doesn't matter. It's usually normal to
add the changes at the same line to keep the history looking neat.</p>
<p>Here's the result of the merge:</p>
<pre><code>Shopping
Take bins out
Water plants
Clean toilets
Write blog post
Email Dad
</code></pre>
<h2>Windows Forms app</h2>
<p>Applying the general principle again:</p>
<table>
  <thead>
    <tr>
      <th>Step</th>
      <th>Commit B1</th>
      <th>Commit B2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1. Syntax</td>
      <td>Change line 5 to <code class="highlighter-rouge">ShowMessage($"Error: {errorMessage}");</code></td>
      <td>Change line 5 to <code class="highlighter-rouge">ShowMessageBox("Error: " + errorMessage);</code></td>
    </tr>
    <tr>
      <td>2. Semantics</td>
      <td>Refactor the string addition to a string interpolation</td>
      <td>Change the name of the called method</td>
    </tr>
    <tr>
      <td>3. Resultant semantics</td>
      <td colspan="2">Refactor the string addition to a string interpolation and change the name of the called method</td>
    </tr>
    <tr>
      <td>4. Resultant syntax</td>
      <td colspan="2">Change line 5 to <code class="highlighter-rouge">ShowMessageBox($"Error: {errorMessage}");</code></td>
    </tr>
  </tbody>
</table>
<p>Because I know this is a C# source document, I am able to work out the meaning
of each of the changes.</p>
<p>Here's the result of the merge:</p>
<pre class="language-cs"><code class="language-cs"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ErrorHelper</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowErrorMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> errorMessage<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">ShowMessageBox</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Error: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">errorMessage</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMessageBox</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>Summary</h2>
<p>Often you'll be able to see what the desired resultant change is pretty quickly,
especially with a bit of experience. It's when you're dealing with a
particularly complicated merge conflict that the steps I've outlined here can be
especially useful.</p>

  </article>
</div>

<div class="container py-6">
  <script src="https://utteranc.es/client.js" repo="djcarter85/codingblog" issue-term="url" label="comments"
    theme="github-light" crossorigin="anonymous" async></script>
</div>
  
  <footer class="footer mt-auto py-4 bg-blue-800 text-gray-50">
    <div class="container flex flex-col gap-2">
      <div class="flex flex-row gap-4 justify-center">
        
        <a class="p-2 rounded-lg hover:bg-blue-500" href="https://github.com/djcarter85" title="GitHub">
          <i class="fab fa-github fa-2x"></i>
        </a>
        
        <a class="p-2 rounded-lg hover:bg-blue-500" href="/Feed/" title="RSS">
          <i class="fa fa-rss fa-2x"></i>
        </a>
        
      </div>
      <div class="text-center">
        &copy; Dan Carter 2023
      </div>
    </div>
  </footer>
  
  <!-- JS -->
  <script defer src="https://use.fontawesome.com/releases/v5.6.3/js/all.js"
    integrity="sha384-EIHISlAOj4zgYieurP0SdoiBYfGJKkgWedPHH4jCzpCXLmzVsw1ouK59MuUtP4a1" crossorigin="anonymous"></script>
  
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"> </script>

</body>

</html>